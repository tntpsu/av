<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhilViz</title>
    <link rel="stylesheet" href="style.css?v=20260218_curve_schedule_compact_v43">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>PhilViz</h1>
            <div id="recording-meta" style="display:flex; gap:0.4rem; align-items:center; margin-right:0.8rem;">
                <span id="recording-type-badge" style="display:none; padding:0.2rem 0.5rem; border-radius:999px; font-size:0.75rem; background:#2a2a2a; color:#cfd8dc; border:1px solid #444;">type</span>
                <span id="topdown-badge" style="display:none; padding:0.2rem 0.5rem; border-radius:999px; font-size:0.75rem; background:#2a2a2a; color:#cfd8dc; border:1px solid #444;">topdown</span>
            </div>
            <div class="header-controls">
                <select id="recording-select" class="recording-select">
                    <option value="">Select recording...</option>
                </select>
                <button id="load-btn" class="btn btn-primary">Load</button>
                <button id="export-frame-btn" class="btn btn-secondary">Export Frame</button>
                <button id="export-video-btn" class="btn btn-secondary">Export Video</button>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content" id="main-content">
            <!-- Left: Camera Frame Display -->
            <div class="camera-panel" id="camera-panel">
                <div class="camera-grid-wrapper" id="camera-grid-wrapper">
                    <div class="camera-grid" id="camera-grid">
                        <div class="canvas-container">
                            <canvas id="camera-canvas" width="640" height="480"></canvas>
                            <canvas id="overlay-canvas" width="640" height="480"></canvas>
                        </div>
                        <div class="topdown-column" id="topdown-column">
                            <div class="canvas-container" id="topdown-container">
                                <canvas id="topdown-canvas" width="640" height="480"></canvas>
                            </div>
                            <div class="quick-debug-panel">
                                <h3>Quick Chart Focus</h3>
                                <div class="quick-debug-controls">
                                    <select id="quick-saved-views-select" class="recording-select">
                                        <option value="">Select a saved view...</option>
                                    </select>
                                    <button id="quick-apply-view-btn" class="btn btn-secondary">Apply View</button>
                                </div>
                                <div class="quick-chart-values-wrap">
                                    <table class="data-table quick-values-table">
                                        <thead>
                                            <tr>
                                                <th>Signal</th>
                                                <th>Value @ Current Frame</th>
                                            </tr>
                                        </thead>
                                        <tbody id="quick-chart-values-body">
                                            <tr><td colspan="2" style="text-align: center; color: #888;">Plot a chart view to see values</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="camera-grid-resize-label">Drag to resize images</div>
                <div class="camera-grid-resize-handle" id="camera-grid-resize-handle"></div>

                <!-- Overlay Toggles -->
                <div class="overlay-controls">
                    <h3>Data Overlays</h3>
                    <div class="overlay-toggles">
                        <label title="Show semantic segmentation mask overlay from recorded model output. Useful to inspect class coverage and mask quality."><input type="checkbox" id="toggle-seg-mask"> Segmentation Mask</label>
                        <label title="Show sampled segmentation fit points used by lane fitting. Use when diagnosing perception fit quality."><input type="checkbox" id="toggle-seg-fit-points"> Model Perception Fit Points</label>
                        <label title="Limit displayed segmentation fit points to the configured fit region-of-interest. Use to debug fit-range effects."><input type="checkbox" id="toggle-seg-fit-roi"> Segmentation Fit Range</label>
                        <div id="cv-data-overlays"></div>
                        <label title="Show ground-truth lane lines from recording (green). Use as oracle lane reference."><input type="checkbox" id="toggle-ground-truth" checked> Ground Truth (Green)</label>
                        <label title="Show detected lane positions from perception (red). Compare against ground truth for drift/errors."><input type="checkbox" id="toggle-lanes" checked> Detected Lanes (Red Lines)</label>
                        <label title="Show planner trajectory overlay (purple) in main and top-down views."><input type="checkbox" id="toggle-trajectory" checked> Trajectory</label>
                        <label title="Show oracle trajectory overlay (green) from Unity lane-center samples."><input type="checkbox" id="toggle-oracle-trajectory"> Oracle Trajectory</label>
                        <label title="Show distance ruler ticks along right lane side at 0m and every 5m ahead. Use to interpret where overlays begin in each camera."><input type="checkbox" id="toggle-distance-scale" checked> Distance Scale (5m)</label>
                        <label title="Show Unity right-lane fiducials (screen-truth vs projected) for projection validation."><input type="checkbox" id="toggle-right-lane-fiducials"> Right-Lane Fiducials</label>
                        <label title="Show controller reference point/heading target. Useful for control-debug alignment checks."><input type="checkbox" id="toggle-reference" checked> Reference Point</label>
                    </div>
                    <details class="overlay-advanced-debug" style="margin-top: 0.75rem;">
                        <summary style="cursor: pointer; color: #bdbdbd;" title="Advanced display/debug toggles. Collapse when not actively debugging projection or serialization details.">Advanced Debug Overlays</summary>
                        <div class="overlay-toggles" style="margin-top: 0.5rem;">
                            <label title="Hide prepended reference point and show planner-only path. Use when isolating planner geometry from display serialization artifacts."><input type="checkbox" id="toggle-planner-only-trajectory"> Planner-Only Trajectory (Skip Prepended Ref Point)</label>
                            <label title="Use top-down camera calibration from recording for projection. Keep enabled for trustable top-down alignment."><input type="checkbox" id="toggle-topdown-calibrated-projection"> Top-Down Calibrated Projection</label>
                            <label title="Apply temporal smoothing to top-down trajectory display only. Use for readability; not used in metrics/control."><input type="checkbox" id="toggle-topdown-pose-smooth"> Smooth Top-Down Pose (Display Only)</label>
                            <label title="Enable near-field main-camera projection blend to reduce short-range projection residuals. Diagnostic/display only."><input type="checkbox" id="toggle-main-nearfield-blend" checked> Main Near-Field Blend</label>
                            <label title="Near-field vertical offset (meters) blended from 0m forward. Negative pulls near points downward in image.">
                                Near-Field Y Offset (m):
                                <input type="range" id="nearfield-y-offset-slider" min="-0.50" max="0.50" step="0.01" value="-0.30">
                                <span id="nearfield-y-offset-value">-0.30</span>
                            </label>
                            <label title="Forward distance over which near-field blend decays to zero.">
                                Near-Field Blend Distance (m):
                                <input type="range" id="nearfield-blend-distance-slider" min="2.0" max="20.0" step="0.5" value="10.0">
                                <span id="nearfield-blend-distance-value">10.0</span>
                            </label>
                        </div>
                    </details>
                    </div>
                </div>

                <!-- Middle: Legend Panel (uses space between camera and data) -->
            <div class="legend-panel collapsed" id="legend-panel">
                <h3>Visual Legend</h3>
                <button id="legend-toggle-btn" class="btn btn-secondary legend-toggle">Collapse</button>
                <div class="overlay-legend legend-extra" style="font-size: 0.9rem; color: #a0a0a0; line-height: 1.8;">
                    <div><span style="color: #00ff00; font-weight: bold;">ðŸŸ¢ Green lines:</span> Ground truth lanes (where lanes should be)</div>
                    <div style="margin-top: 0.75rem;"><span style="color: #ff0000; font-weight: bold;">ðŸ”´ Red lines:</span> Detected lane positions at lookahead (vehicle coords converted to pixels)</div>
                    <div style="margin-top: 0.75rem;"><span style="color: #ff8800; font-weight: bold;">ðŸŸ  Orange curves:</span> Actual detected lane curves (polynomial curves in image space)</div>
                    <div style="margin-top: 0.75rem;">ðŸ”´ <strong>Red dot/arrow:</strong> Reference point (target position at lookahead distance)</div>
                    <div style="margin-top: 0.5rem; margin-left: 1rem;">Arrow shows <strong>desired heading direction</strong> (not steering angle)</div>
                </div>
                <div class="legend-extra" style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #444;">
                    <label style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem;">
                        Ground Truth Distance (m):
                    </label>
                    <select id="gt-distance-select" style="width: 100%; padding: 0.5rem; background: #2a2a2a; color: white; border: 1px solid #444; border-radius: 4px;">
                        <option value="auto" selected>Auto (from recording)</option>
                        <option value="5.0">5.0m</option>
                        <option value="5.5">5.5m</option>
                        <option value="6.0">6.0m</option>
                        <option value="6.5">6.5m</option>
                        <option value="7.0">7.0m</option>
                        <option value="7.5">7.5m</option>
                        <option value="8.0">8.0m</option>
                        <option value="8.5">8.5m</option>
                        <option value="9.0">9.0m</option>
                        <option value="9.5">9.5m</option>
                        <option value="10.0">10.0m</option>
                    </select>
                    <small style="color: #888; display: block; margin-top: 0.25rem; font-size: 0.85rem;">
                        Adjust to align green lines with red lines
                    </small>
                </div>
                <div class="legend-extra" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #444;">
                    <label style="display: flex; align-items: center; cursor: pointer; color: #e0e0e0; font-size: 0.9rem;" title="If checked, analysis stops at the point where the car went out of lane and stayed out (>10 consecutive frames out of lane). Applies to Summary and Diagnostics tabs.">
                        <input type="checkbox" id="analyze-to-failure" style="margin-right: 0.5rem; cursor: pointer;">
                        <span>Analyze to out of bounds</span>
                    </label>
                    <div style="margin-top: 0.75rem; display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; color: #e0e0e0; font-size: 0.85rem;">
                        <span>Entry window (distance):</span>
                        <label>start
                            <input id="diag-entry-start-distance" type="number" value="34" step="0.5" style="width: 70px; margin-left: 0.25rem; background: #2a2a2a; color: white; border: 1px solid #444; border-radius: 4px; padding: 0.2rem;">
                        </label>
                        <label>len
                            <input id="diag-entry-window-distance" type="number" value="8" step="0.5" min="0.5" style="width: 70px; margin-left: 0.25rem; background: #2a2a2a; color: white; border: 1px solid #444; border-radius: 4px; padding: 0.2rem;">
                        </label>
                        <span style="color:#888;">meters from run start</span>
                    </div>
                </div>
            </div>

            <div class="panel-resize-handle" id="panel-resize-handle"></div>
            <!-- Right: Data Side Panel -->
            <div class="data-panel" id="data-panel">
                <div class="tabs">
                    <button class="tab-btn" data-tab="summary">Summary</button>
                    <button class="tab-btn" data-tab="issues">Issues</button>
                    <button class="tab-btn" data-tab="diagnostics">Diagnostics</button>
                    <button class="tab-btn active" data-tab="all-data">All Data</button>
                    <button class="tab-btn" data-tab="perception">Perception</button>
                    <button class="tab-btn" data-tab="trajectory">Trajectory</button>
                    <button class="tab-btn" data-tab="projection">Projection</button>
                    <button class="tab-btn" data-tab="control">Control</button>
                    <button class="tab-btn" data-tab="vehicle">Vehicle</button>
                    <button class="tab-btn" data-tab="ground-truth">Ground Truth</button>
                    <button class="tab-btn" data-tab="charts">Charts</button>
                </div>

                <div class="tab-content">
                    <!-- Summary Tab -->
                    <div id="summary-tab" class="tab-pane">
                        <div id="summary-content">
                            <p style="color: #888; text-align: center; padding: 2rem;">
                                Load a recording to see summary metrics
                            </p>
                        </div>
                    </div>
                    
                    <!-- Issues Tab -->
                    <div id="issues-tab" class="tab-pane">
                        <div id="issues-content" style="max-height: 70vh; overflow-y: auto; padding-right: 10px;">
                            <p style="color: #888; text-align: center; padding: 2rem;">
                                Load a recording to see detected issues
                            </p>
                        </div>
                    </div>
                    
                    <!-- Diagnostics Tab -->
                    <div id="diagnostics-tab" class="tab-pane">
                        <div id="diagnostics-content" style="max-height: 70vh; overflow-y: auto; padding-right: 10px;">
                            <p style="color: #888; text-align: center; padding: 2rem;">
                                Load a recording to see trajectory vs steering diagnostics
                            </p>
                        </div>
                    </div>

                    <!-- All Data Tab -->
                    <div id="all-data-tab" class="tab-pane active">
                        <h3>Perception</h3>
                        <table class="data-table">
                            <tr><td>Method</td><td id="all-perception-method">-</td></tr>
                            <tr><td>Confidence</td><td id="all-perception-confidence">-</td></tr>
                            <tr><td>Lanes Detected</td><td id="all-perception-num-lanes">-</td></tr>
                            <tr><td>Left Lane Line X<br/><small style="color: #888;">(stored/used)</small></td><td id="all-perception-left-x">-</td></tr>
                            <tr id="all-perception-actual-left-row" style="display: none;"><td>Left Lane (Actual Detected)<br/><small style="color: #888;">(rejected)</small></td><td id="all-perception-actual-left-x" style="color: #ffa500;">-</td></tr>
                            <tr><td>Right Lane Line X<br/><small style="color: #888;">(stored/used)</small></td><td id="all-perception-right-x">-</td></tr>
                            <tr id="all-perception-actual-right-row" style="display: none;"><td>Right Lane (Actual Detected)<br/><small style="color: #888;">(rejected)</small></td><td id="all-perception-actual-right-x" style="color: #ffa500;">-</td></tr>
                            <tr><td>Lane Width</td><td id="all-perception-width">-</td></tr>
                            <tr><td>Using Stale Data</td><td id="all-perception-using-stale" style="color: #ff6b6b;">-</td></tr>
                            <tr><td>Stale Reason</td><td id="all-perception-stale-reason" style="color: #ff6b6b;">-</td></tr>
                            <tr><td>Reject Reason</td><td id="all-perception-reject-reason" style="color: #ff6b6b;">-</td></tr>
                            <tr id="all-perception-instability-row" style="display: none;"><td>Width Change (m)<br/><small style="color: #888;">vs prev frame</small></td><td id="all-perception-width-change" style="color: #ffa500;">-</td></tr>
                            <tr id="all-perception-instability-row-2" style="display: none;"><td>Center Shift (m)<br/><small style="color: #888;">vs prev frame</small></td><td id="all-perception-center-shift" style="color: #ffa500;">-</td></tr>
                            <tr id="all-perception-jump-row" style="display: none;"><td>Left Jump (m)</td><td id="all-perception-left-jump">-</td></tr>
                            <tr id="all-perception-jump-row-2" style="display: none;"><td>Right Jump (m)</td><td id="all-perception-right-jump">-</td></tr>
                            <tr id="all-perception-jump-row-3" style="display: none;"><td>Jump Threshold (m)</td><td id="all-perception-jump-threshold">-</td></tr>
                            <tr><td style="border-top: 1px solid #444; padding-top: 0.5rem;">Consecutive Bad Frames</td><td id="all-perception-consecutive-bad" style="border-top: 1px solid #444; padding-top: 0.5rem;">-</td></tr>
                            <tr><td>Health Score</td><td id="all-perception-health-score">-</td></tr>
                            <tr><td>Health Status</td><td id="all-perception-health-status">-</td></tr>
                            <tr><td>Health Bad Events</td><td id="all-perception-health-bad-events">-</td></tr>
                            <tr><td>Recent Bad Events</td><td id="all-perception-health-bad-events-recent">-</td></tr>
                            <tr><td>Clamp Events</td><td id="all-perception-clamp-events">-</td></tr>
                            <tr><td>Timestamp Frozen</td><td id="all-perception-timestamp-frozen">-</td></tr>
                            <tr><td>Unity Frame Reused</td><td id="all-vehicle-unity-frame-reused">-</td></tr>
                            <tr><td>Camera Timestamp Reused</td><td id="all-vehicle-camera-timestamp-reused">-</td></tr>
                        </table>
                        
                        <h3>Camera Calibration</h3>
                        <table class="data-table">
                            <tr><td>8m Screen Y (px)</td><td id="all-vehicle-camera-8m-y">-</td></tr>
                            <tr><td>Vertical FOV (Â°)</td><td id="all-vehicle-camera-fov-vertical">-</td></tr>
                            <tr><td>Horizontal FOV (Â°)</td><td id="all-vehicle-camera-fov-horizontal">-</td></tr>
                            <tr><td>Config Horizontal FOV (Â°)</td><td id="all-vehicle-camera-fov-config">-</td></tr>
                            <tr><td>Config Camera Height (m)</td><td id="all-vehicle-camera-height-config">-</td></tr>
                        </table>
                        <h3>Unity Timing</h3>
                        <table class="data-table">
                            <tr><td>Camera Timestamp</td><td id="all-vehicle-camera-timestamp">-</td></tr>
                            <tr><td>Top-Down Timestamp</td><td id="all-vehicle-topdown-timestamp">-</td></tr>
                            <tr><td>Camera Frame ID</td><td id="all-vehicle-camera-frame-id">-</td></tr>
                            <tr><td>Top-Down Frame ID</td><td id="all-vehicle-topdown-frame-id">-</td></tr>
                            <tr><td>Camera Timestamp Reused</td><td id="all-vehicle-camera-timestamp-reused">-</td></tr>
                            <tr><td>Unity Time</td><td id="all-vehicle-unity-time">-</td></tr>
                            <tr><td>Top-Down â†” Trajectory Î”t</td><td id="all-vehicle-topdown-traj-delta">-</td></tr>
                            <tr><td>Top-Down â†” Unity Î”t</td><td id="all-vehicle-topdown-unity-delta">-</td></tr>
                            <tr><td>Top-Down Sync Trust</td><td id="all-vehicle-topdown-sync-trust">-</td></tr>
                            <tr><td>Unity Frame</td><td id="all-vehicle-unity-frame">-</td></tr>
                            <tr><td>Delta Time</td><td id="all-vehicle-unity-delta-time">-</td></tr>
                            <tr><td>Smooth Delta Time</td><td id="all-vehicle-unity-smooth-delta-time">-</td></tr>
                            <tr><td>Unscaled Delta Time</td><td id="all-vehicle-unity-unscaled-delta-time">-</td></tr>
                            <tr><td>Time Scale</td><td id="all-vehicle-unity-time-scale">-</td></tr>
                            <tr><td>Unity Time Gap</td><td id="all-vehicle-unity-time-gap">-</td></tr>
                            <tr><td>Unity Frame Reused</td><td id="all-vehicle-unity-frame-reused">-</td></tr>
                        </table>
                        <h3>Steering (Unity)</h3>
                        <table class="data-table">
                            <tr><td>Steering Input (norm)</td><td id="all-vehicle-steering-input">-</td></tr>
                            <tr><td>Desired Steer Angle (Â°)</td><td id="all-vehicle-desired-steer-angle">-</td></tr>
                            <tr><td>Steering Angle Actual (Â°)</td><td id="all-vehicle-steering-angle-actual">-</td></tr>
                        </table>
                        <h3>Camera Position (Unity)</h3>
                        <table class="data-table">
                            <tr><td>Position X (world)</td><td id="all-vehicle-camera-pos-x">-</td></tr>
                            <tr><td>Height Above Ground</td><td id="all-vehicle-camera-pos-y">-</td></tr>
                            <tr><td>Position Z (world)</td><td id="all-vehicle-camera-pos-z">-</td></tr>
                            <tr><td>Forward X</td><td id="all-vehicle-camera-forward-x">-</td></tr>
                            <tr><td>Forward Y</td><td id="all-vehicle-camera-forward-y">-</td></tr>
                            <tr><td>Forward Z</td><td id="all-vehicle-camera-forward-z">-</td></tr>
                        </table>
                        <h3>Road Center Debug</h3>
                        <table class="data-table">
                            <tr><td>At Car X</td><td id="all-road-center-at-car-x">-</td></tr>
                            <tr><td>At Car Y</td><td id="all-road-center-at-car-y">-</td></tr>
                            <tr><td>At Car Z</td><td id="all-road-center-at-car-z">-</td></tr>
                            <tr><td>At Lookahead X</td><td id="all-road-center-at-lookahead-x">-</td></tr>
                            <tr><td>At Lookahead Y</td><td id="all-road-center-at-lookahead-y">-</td></tr>
                            <tr><td>At Lookahead Z</td><td id="all-road-center-at-lookahead-z">-</td></tr>
                            <tr><td>Actual Distance (m)</td><td id="all-road-center-actual-distance">-</td></tr>
                            <tr><td>Reference T</td><td id="all-road-center-reference-t">-</td></tr>
                            <tr><td>Car Offset X<br/><small style="color: #888;">(car X - road center X)</small></td><td id="all-road-center-offset-x">-</td></tr>
                            <tr><td>Car Offset Z<br/><small style="color: #888;">(car Z - road center Z)</small></td><td id="all-road-center-offset-z">-</td></tr>
                        </table>
                        <h3>Trajectory</h3>
                        <table class="data-table">
                            <tr><td>Reference X (lateral)</td><td id="all-trajectory-x">-</td></tr>
                            <tr><td>Reference Y (forward)</td><td id="all-trajectory-y">-</td></tr>
                            <tr><td title="Planner-frame heading from trajectory/reference_point_heading">Reference Heading (planner frame)</td><td id="all-trajectory-heading">-</td></tr>
                            <tr><td>Reference Velocity</td><td id="all-trajectory-velocity">-</td></tr>
                        </table>
                        
                        <h3>Control</h3>
                        <table class="data-table">
                            <tr><td>Steering</td><td id="all-control-steering">-</td></tr>
                            <tr><td>Throttle</td><td id="all-control-throttle">-</td></tr>
                            <tr><td>Brake</td><td id="all-control-brake">-</td></tr>
                            <tr><td>Longitudinal Accel</td><td id="all-control-accel">-</td></tr>
                            <tr><td>Longitudinal Jerk</td><td id="all-control-jerk">-</td></tr>
                            <tr><td>Ref Point X</td><td id="all-control-ref-x">-</td></tr>
                            <tr><td>Ref Point Y</td><td id="all-control-ref-y">-</td></tr>
                            <tr><td title="Planner-frame heading passed to control">Ref Heading (planner frame)</td><td id="all-control-ref-heading">-</td></tr>
                            <tr><td>Ref Speed</td><td id="all-control-ref-speed">-</td></tr>
                            <tr><td>Target Speed (raw)</td><td id="all-control-target-speed-raw">-</td></tr>
                            <tr><td>Target Speed (post limits)</td><td id="all-control-target-speed-post-limits">-</td></tr>
                            <tr><td>Target Speed (planned)</td><td id="all-control-target-speed-planned">-</td></tr>
                            <tr><td>Target Speed (final)</td><td id="all-control-target-speed-final">-</td></tr>
                            <tr><td>Target Slew Active</td><td id="all-control-target-speed-slew-active">-</td></tr>
                            <tr><td>Target Ramp Active</td><td id="all-control-target-speed-ramp-active">-</td></tr>
                            <tr><td>Launch Throttle Cap</td><td id="all-control-launch-throttle-cap">-</td></tr>
                            <tr><td>Launch Cap Active</td><td id="all-control-launch-throttle-cap-active">-</td></tr>
                            <tr><td>Lateral Error</td><td id="all-control-lateral-error">-</td></tr>
                            <tr><td>Heading Error</td><td id="all-control-heading-error">-</td></tr>
                            <tr><td>Total Error</td><td id="all-control-total-error">-</td></tr>
                            <tr><td>Total Error (scaled)</td><td id="all-control-total-error-scaled">-</td></tr>
                            <tr><td>Feedforward Steering</td><td id="all-control-feedforward-steering">-</td></tr>
                            <tr><td>Feedback Steering</td><td id="all-control-feedback-steering">-</td></tr>
                            <tr><td>Straight Sign Flip Override</td><td id="all-control-straight-sign-flip-override">-</td></tr>
                            <tr><td>PID Integral</td><td id="all-control-pid-integral">-</td></tr>
                            <tr><td>Is Straight</td><td id="all-control-is-straight">-</td></tr>
                            <tr><td>Straight Oscillation Rate</td><td id="all-control-straight-oscillation-rate">-</td></tr>
                            <tr><td>Tuned Deadband</td><td id="all-control-tuned-deadband">-</td></tr>
                            <tr><td>Tuned Smoothing Alpha</td><td id="all-control-tuned-smoothing-alpha">-</td></tr>
                            <tr><td>Using Stale Perception</td><td id="all-control-using-stale" style="color: #ff6b6b;">-</td></tr>
                            <tr><td>Stale Reason</td><td id="all-control-stale-reason" style="color: #ff6b6b;">-</td></tr>
                        </table>
                        
                        <h3>Vehicle</h3>
                        <table class="data-table">
                            <tr><td>Position X</td><td id="all-vehicle-x">-</td></tr>
                            <tr><td>Position Y</td><td id="all-vehicle-y">-</td></tr>
                            <tr><td>Position Z</td><td id="all-vehicle-z">-</td></tr>
                            <tr><td>Speed</td><td id="all-vehicle-speed">-</td></tr>
                            <tr><td>Distance from Start</td><td id="all-vehicle-distance-from-start">-</td></tr>
                            <tr><td>Longitudinal Accel</td><td id="all-vehicle-accel">-</td></tr>
                            <tr><td>Longitudinal Jerk</td><td id="all-vehicle-jerk">-</td></tr>
                            <tr><td>Speed Limit</td><td id="all-vehicle-speed-limit">-</td></tr>
                            <tr><td>Speed Limit Preview</td><td id="all-vehicle-speed-limit-preview">-</td></tr>
                            <tr><td>Preview Distance</td><td id="all-vehicle-speed-limit-preview-distance">-</td></tr>
                            <tr><td title="Vehicle world heading from pose/quaternion">Heading (vehicle/world)</td><td id="all-vehicle-heading">-</td></tr>
                            <tr><td>Steering Angle</td><td id="all-vehicle-steering">-</td></tr>
                            <tr><td>Actual Distance to Road Center (m)</td><td id="all-vehicle-actual-distance">-</td></tr>
                        </table>
                        
                        <h3>Ground Truth</h3>
                        <table class="data-table">
                            <tr><td>Left Lane Line X</td><td id="all-gt-left-x">-</td></tr>
                            <tr><td>Right Lane Line X</td><td id="all-gt-right-x">-</td></tr>
                            <tr><td>Lane Center X</td><td id="all-gt-center-x">-</td></tr>
                            <tr><td>Lane Width</td><td id="all-gt-width">-</td></tr>
                            <tr><td>Path Curvature</td><td id="all-gt-path-curvature">-</td></tr>
                            <tr><td>Curve Speed Limit</td><td id="all-gt-curve-speed-limit">-</td></tr>
                            <tr><td>Lane Width Error<br/><small style="color: #888;">(perception vs GT)</small></td><td id="all-gt-width-error">-</td></tr>
                            <tr><td>Center Offset Error<br/><small style="color: #888;">(perception vs GT)</small></td><td id="all-gt-center-error">-</td></tr>
                        </table>
                    </div>

                    <!-- Perception Tab -->
                    <div id="perception-tab" class="tab-pane">
                        <h3>Lane Detection</h3>
                        <table class="data-table">
                            <tr><td>Method</td><td id="perception-method">-</td></tr>
                            <tr><td>Confidence</td><td id="perception-confidence">-</td></tr>
                            <tr><td>Lanes Detected</td><td id="perception-num-lanes">-</td></tr>
                            <tr><td>Left Lane Line X<br/><small style="color: #888;">(stored/used)</small></td><td id="perception-left-x">-</td></tr>
                            <tr id="perception-actual-left-row" style="display: none;"><td>Left Lane (Actual Detected)<br/><small style="color: #888;">(rejected)</small></td><td id="perception-actual-left-x" style="color: #ffa500;">-</td></tr>
                            <tr><td>Right Lane Line X<br/><small style="color: #888;">(stored/used)</small></td><td id="perception-right-x">-</td></tr>
                            <tr id="perception-actual-right-row" style="display: none;"><td>Right Lane (Actual Detected)<br/><small style="color: #888;">(rejected)</small></td><td id="perception-actual-right-x" style="color: #ffa500;">-</td></tr>
                            <tr><td>Lane Width</td><td id="perception-width">-</td></tr>
                            <tr><td>Using Stale Data</td><td id="perception-using-stale" style="color: #ff6b6b;">-</td></tr>
                            <tr><td>Stale Reason</td><td id="perception-stale-reason" style="color: #ff6b6b;">-</td></tr>
                            <tr><td>Reject Reason</td><td id="perception-reject-reason" style="color: #ff6b6b;">-</td></tr>
                            <tr id="perception-instability-row" style="display: none;"><td>Width Change (m)<br/><small style="color: #888;">vs prev frame</small></td><td id="perception-width-change" style="color: #ffa500;">-</td></tr>
                            <tr id="perception-instability-row-2" style="display: none;"><td>Center Shift (m)<br/><small style="color: #888;">vs prev frame</small></td><td id="perception-center-shift" style="color: #ffa500;">-</td></tr>
                            <tr id="perception-jump-row" style="display: none;"><td>Left Jump (m)</td><td id="perception-left-jump">-</td></tr>
                            <tr id="perception-jump-row-2" style="display: none;"><td>Right Jump (m)</td><td id="perception-right-jump">-</td></tr>
                            <tr id="perception-jump-row-3" style="display: none;"><td>Jump Threshold (m)</td><td id="perception-jump-threshold">-</td></tr>
                            <tr><td style="border-top: 1px solid #444; padding-top: 0.5rem;">Consecutive Bad Frames</td><td id="perception-consecutive-bad" style="border-top: 1px solid #444; padding-top: 0.5rem;">-</td></tr>
                            <tr><td>Health Score</td><td id="perception-health-score">-</td></tr>
                            <tr><td>Health Status</td><td id="perception-health-status">-</td></tr>
                            <tr><td>Health Bad Events</td><td id="perception-health-bad-events">-</td></tr>
                            <tr><td>Recent Bad Events</td><td id="perception-health-bad-events-recent">-</td></tr>
                            <tr><td>Clamp Events</td><td id="perception-clamp-events">-</td></tr>
                            <tr><td>Timestamp Frozen</td><td id="perception-timestamp-frozen">-</td></tr>
                        </table>
                        
                        <!-- Polynomial Inspector -->
                        <div style="margin-top: 1.5rem; border-top: 1px solid #444; padding-top: 1rem;">
                            <h3 style="margin-bottom: 0.5rem;">Polynomial Inspector</h3>
                            <button id="polynomial-inspector-btn" style="padding: 0.5rem 1rem; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer; margin-bottom: 0.5rem;">
                                Analyze Current Frame
                            </button>
                            <div id="polynomial-inspector-results" style="display: none; margin-top: 1rem; padding: 1rem; background: #2a2a2a; border-radius: 4px; font-size: 0.9rem;">
                                <div id="polynomial-inspector-content">Loading...</div>
                            </div>
                        </div>
                    </div>

                    <!-- Trajectory Tab -->
                    <div id="trajectory-tab" class="tab-pane">
                        <h3>Reference Point</h3>
                        <table class="data-table">
                            <tr><td>X (lateral)</td><td id="trajectory-x">-</td></tr>
                            <tr><td>Y (forward)</td><td id="trajectory-y">-</td></tr>
                            <tr><td title="Planner-frame heading from trajectory/reference_point_heading">Heading (planner frame)</td><td id="trajectory-heading">-</td></tr>
                            <tr><td>Velocity</td><td id="trajectory-velocity">-</td></tr>
                        </table>
                        <h3>Raw Reference Point</h3>
                        <table class="data-table">
                            <tr><td>X (raw)</td><td id="trajectory-raw-x">-</td></tr>
                            <tr><td>Y (raw)</td><td id="trajectory-raw-y">-</td></tr>
                            <tr><td title="Raw planner-frame heading before smoothing">Heading (raw planner frame)</td><td id="trajectory-raw-heading">-</td></tr>
                        </table>
                        <h3>Reference Point Debug</h3>
                        <table class="data-table">
                            <tr><td>Calculation Method</td><td id="trajectory-method">-</td></tr>
                            <tr><td>Perception Center X</td><td id="trajectory-perception-center">-</td></tr>
                            <tr><td>Trajectory vs Perception</td><td id="trajectory-vs-perception">-</td></tr>
                        </table>
                        <h3>Trajectory Layer Localization (Run Summary)</h3>
                        <table class="data-table">
                            <tr><td>Localization Hint</td><td id="trajectory-layer-summary-hint">-</td></tr>
                            <tr><td>Dominant Error Band</td><td id="trajectory-layer-summary-dominant-band">-</td></tr>
                            <tr><td>X Clip Any Rate</td><td id="trajectory-layer-summary-xclip-rate">-</td></tr>
                            <tr><td>Lateral Error Mean 0-8m</td><td id="trajectory-layer-summary-err-0-8m">-</td></tr>
                            <tr><td>Lateral Error Mean 8-12m</td><td id="trajectory-layer-summary-err-8-12m">-</td></tr>
                            <tr><td>Lateral Error Mean 12-20m</td><td id="trajectory-layer-summary-err-12-20m">-</td></tr>
                            <tr><td>Preclip |X| P95</td><td id="trajectory-layer-summary-preclip-p95">-</td></tr>
                        </table>
                        <h3>Trajectory Suppression Waterfall (Proxy)</h3>
                        <table class="data-table">
                            <tr><td>Raw Ref Heading</td><td id="projection-traj-raw-ref-heading">-</td></tr>
                            <tr><td>Raw Ref X</td><td id="projection-traj-raw-ref-x">-</td></tr>
                            <tr><td title="Hysteretic straightness gate from center curvature proxy + raw heading. ON while |a_center| and |raw_heading| stay below OFF thresholds; turns ON only when both fall below tighter ON thresholds.">Heading Zero Gate (Hysteretic `a_center + raw_heading`)</td><td id="projection-traj-heading-zero-gate">-</td></tr>
                            <tr><td title="Raw gate inputs for heading-zero hysteresis: |a_center| and |raw_heading| with ON/OFF thresholds.">Heading Zero Gate Inputs (`|a_center|, |raw_heading| / on-off th`)</td><td id="projection-traj-heading-zero-gate-inputs">-</td></tr>
                            <tr><td title="Small-heading proxy gate. ON when |raw_ref_heading| < 1 degree (0.01745 rad).">Small Heading Gate (`|raw_ref_heading| &lt; 1 deg`)</td><td id="projection-traj-small-heading-gate">-</td></tr>
                            <tr><td title="Raw gate inputs for small-heading check: absolute raw heading vs threshold.">Small Heading Gate Inputs (`|raw_heading| / threshold`)</td><td id="projection-traj-small-heading-gate-inputs">-</td></tr>
                            <tr><td title="ON when diag_smoothing_jump_reject > 0.5 (smoothing layer rejected a jump).">Smoothing Jump Reject Active</td><td id="projection-traj-smoothing-jump-reject">-</td></tr>
                            <tr><td title="ON when diag_ref_x_rate_limit_active > 0.5 (ref_x change exceeded rate cap).">Ref X Rate-Limit Active</td><td id="projection-traj-ref-x-rate-limit-active">-</td></tr>
                            <tr><td>Smoothed Ref Heading</td><td id="projection-traj-smoothed-ref-heading">-</td></tr>
                            <tr><td>Heading Suppression |Î”|</td><td id="projection-traj-heading-suppression-abs">-</td></tr>
                            <tr><td>Smoothed Ref X</td><td id="projection-traj-smoothed-ref-x">-</td></tr>
                            <tr><td>Ref X Suppression |Î”|</td><td id="projection-traj-ref-x-suppression-abs">-</td></tr>
                            <tr><td>Smoothing Alpha / Alpha X</td><td id="projection-traj-smoothing-alpha-pair">-</td></tr>
                            <tr><td title="ON when reference method is multi_lookahead_heading_blend (or diag flag indicates active).">Multi-Lookahead Blend Active</td><td id="projection-traj-multilookahead-active">-</td></tr>
                            <tr><td>ML Heading Base / Far / Blended</td><td id="projection-traj-ml-heading-breakdown">-</td></tr>
                            <tr><td>ML Blend Alpha</td><td id="projection-traj-ml-blend-alpha">-</td></tr>
                            <tr><td>Dynamic Effective Horizon (m)</td><td id="projection-traj-dynamic-horizon-m">-</td></tr>
                            <tr><td>Dynamic Horizon Base / Min / Max (m)</td><td id="projection-traj-dynamic-horizon-bounds-m">-</td></tr>
                            <tr><td>Dynamic Horizon Scales (speed / curv / conf / final)</td><td id="projection-traj-dynamic-horizon-scales">-</td></tr>
                            <tr><td>Dynamic Horizon Inputs (speed / |curv| / conf)</td><td id="projection-traj-dynamic-horizon-inputs">-</td></tr>
                            <tr><td>Dynamic Horizon Limiter Code</td><td id="projection-traj-dynamic-horizon-limiter-code">-</td></tr>
                            <tr><td title="ON when dynamic effective horizon policy is behaviorally applied this frame (diag_dynamic_effective_horizon_applied > 0.5).">Dynamic Horizon Applied</td><td id="projection-traj-dynamic-horizon-applied">-</td></tr>
                            <tr><td>X Clip Count</td><td id="projection-traj-x-clip-count">-</td></tr>
                            <tr><td>Heavy X Clipping (`>= 8`)</td><td id="projection-traj-heavy-x-clipping">-</td></tr>
                            <tr><td>Preclip |X| Max (full path)</td><td id="projection-traj-preclip-abs-max">-</td></tr>
                            <tr><td>Preclip |X| P95 (full path)</td><td id="projection-traj-preclip-abs-p95">-</td></tr>
                            <tr><td>Preclip |X| Mean 0-8m (planner source)</td><td id="projection-traj-preclip-mean-0-8m">-</td></tr>
                            <tr><td>Preclip |X| Mean 8-12m (planner source)</td><td id="projection-traj-preclip-mean-8-12m">-</td></tr>
                            <tr><td>Preclip |X| Mean 12-20m (planner source)</td><td id="projection-traj-preclip-mean-12-20m">-</td></tr>
                            <tr><td>Preclip |X| Mean 12-20m (lane source only)</td><td id="projection-traj-preclip-lane-source-abs-mean-12-20m">-</td></tr>
                            <tr><td>Preclip |Î”X| Mean 12-20m (distance scaling)</td><td id="projection-traj-preclip-distance-scale-abs-mean-12-20m">-</td></tr>
                            <tr><td>Preclip |Î”X| Mean 12-20m (camera offset)</td><td id="projection-traj-preclip-camera-offset-abs-mean-12-20m">-</td></tr>
                            <tr><td>Preclip X Mean 12-20m (lane source only, signed)</td><td id="projection-traj-preclip-lane-source-mean-12-20m">-</td></tr>
                            <tr><td>Preclip Î”X Mean 12-20m (distance scaling, signed)</td><td id="projection-traj-preclip-distance-scale-mean-12-20m">-</td></tr>
                            <tr><td>Preclip Î”X Mean 12-20m (camera offset, signed)</td><td id="projection-traj-preclip-camera-offset-mean-12-20m">-</td></tr>
                            <tr><td>Postclip |X| Mean 12-20m</td><td id="projection-traj-postclip-mean-12-20m">-</td></tr>
                            <tr><td>Postclip Near-Clip Frac 12-20m</td><td id="projection-traj-postclip-nearclip-frac-12-20m">-</td></tr>
                            <tr><td>Front Frame ID Delta</td><td id="projection-traj-front-frame-delta">-</td></tr>
                            <tr><td>Front Unity Î”t (ms)</td><td id="projection-traj-front-unity-dt-ms">-</td></tr>
                            <tr><td title="Current implementation: mirrors sync-contract misalignment risk (trajectory/control sync status is misaligned/missing).">Overlay Snap Risk</td><td id="projection-traj-overlay-snap-risk">-</td></tr>
                            <tr><td title="ON when sync trajectory/control status is misaligned or missing.">Contract Misaligned Risk</td><td id="projection-traj-contract-misaligned-risk">-</td></tr>
                            <tr><td title="ON when front frame delta exceeds policy threshold OR front unity dt exceeds threshold.">Cadence Risk</td><td id="projection-traj-cadence-risk">-</td></tr>
                            <tr><td>Cadence Policy / Thresholds</td><td id="projection-traj-cadence-policy">-</td></tr>
                            <tr><td>Control Curvature / Oracle @10m</td><td id="projection-traj-control-curv-ratio-10m">-</td></tr>
                            <tr><td title="ON when curvature_ratio_10m < 0.6 (planner turning weaker than oracle at 10m).">Under-Turn Flag @10m</td><td id="projection-traj-underturn-10m-flag">-</td></tr>
                            <tr><td>Lateral Error Mean 0-8m</td><td id="projection-traj-band-err-0-8m">-</td></tr>
                            <tr><td>Lateral Error Mean 8-12m</td><td id="projection-traj-band-err-8-12m">-</td></tr>
                            <tr><td>Lateral Error Mean 12-20m</td><td id="projection-traj-band-err-12-20m">-</td></tr>
                            <tr><td>Planner |X| Max 12-20m</td><td id="projection-traj-band-absx-max-12-20m">-</td></tr>
                            <tr><td>Near-Clip Fraction 12-20m</td><td id="projection-traj-band-nearclip-frac-12-20m">-</td></tr>
                            <tr><td>Dominant Failure Band</td><td id="projection-traj-dominant-failure-band">-</td></tr>
                            <tr><td>Triage Hint</td><td id="projection-traj-triage-hint">-</td></tr>
                            <tr><td>Waterfall Source</td><td id="projection-traj-waterfall-source">-</td></tr>
                        </table>
                        <h3>Sync Contract</h3>
                        <table class="data-table">
                            <tr><td>Overall Alignment Status</td><td id="projection-sync-overall-status">-</td></tr>
                            <tr><td>Trajectory Alignment</td><td id="projection-sync-traj-status">-</td></tr>
                            <tr><td>Control Alignment</td><td id="projection-sync-control-status">-</td></tr>
                            <tr><td>Alignment Window (ms)</td><td id="projection-sync-window-ms">-</td></tr>
                            <tr><td>Camera â†” Trajectory Î”t (ms)</td><td id="projection-sync-cam-traj-dt-ms">-</td></tr>
                            <tr><td>Camera â†” Control Î”t (ms)</td><td id="projection-sync-cam-control-dt-ms">-</td></tr>
                            <tr><td>Camera â†” Vehicle Î”t (ms)</td><td id="projection-sync-cam-vehicle-dt-ms">-</td></tr>
                            <tr><td>Trajectory Align Reason</td><td id="projection-sync-traj-reason">-</td></tr>
                            <tr><td>Control Align Reason</td><td id="projection-sync-control-reason">-</td></tr>
                        </table>
                        <h3>Clock Integrity</h3>
                        <table class="data-table">
                            <tr><td>Front Timestamp Reused</td><td id="projection-clock-front-ts-reused">-</td></tr>
                            <tr><td>Front Timestamp Non-Monotonic</td><td id="projection-clock-front-ts-nonmono">-</td></tr>
                            <tr><td>Front Frame ID Reused</td><td id="projection-clock-front-id-reused">-</td></tr>
                            <tr><td>Front Negative Frame Delta</td><td id="projection-clock-front-negative-delta">-</td></tr>
                            <tr><td>Front Clock Jump</td><td id="projection-clock-front-jump">-</td></tr>
                            <tr><td>Top-Down Timestamp Reused</td><td id="projection-clock-top-ts-reused">-</td></tr>
                            <tr><td>Top-Down Timestamp Non-Monotonic</td><td id="projection-clock-top-ts-nonmono">-</td></tr>
                            <tr><td>Top-Down Frame ID Reused</td><td id="projection-clock-top-id-reused">-</td></tr>
                            <tr><td>Top-Down Negative Frame Delta</td><td id="projection-clock-top-negative-delta">-</td></tr>
                            <tr><td>Top-Down Clock Jump</td><td id="projection-clock-top-jump">-</td></tr>
                        </table>
                    </div>

                    <!-- Projection Tab -->
                    <div id="projection-tab" class="tab-pane">
                        <h3>Main Camera Projection</h3>
                        <table class="data-table">
                            <tr><td>First Visible Source Y</td><td id="projection-main-first-visible-y">-</td></tr>
                            <tr><td>Mirror Sanity</td><td id="projection-main-mirror-sanity">-</td></tr>
                            <tr><td>Turn Sign (Source)</td><td id="projection-source-turn-sign">-</td></tr>
                            <tr><td>Turn Sign (Main Visible)</td><td id="projection-main-turn-sign">-</td></tr>
                            <tr><td>Near-Field Blend</td><td id="projection-main-nearfield-blend">-</td></tr>
                            <tr><td>Near-Field Y Offset</td><td id="projection-main-nearfield-y-offset">-</td></tr>
                            <tr><td>Near-Field Blend Distance</td><td id="projection-main-nearfield-blend-distance">-</td></tr>
                        </table>
                        <h3>Lateral Error at Lookahead</h3>
                        <table class="data-table">
                            <tr><td>Error @ 5m</td><td id="projection-lateral-error-5m">-</td></tr>
                            <tr><td>Error @ 10m</td><td id="projection-lateral-error-10m">-</td></tr>
                            <tr><td>Error @ 15m</td><td id="projection-lateral-error-15m">-</td></tr>
                            <tr><td>Error Source</td><td id="projection-lateral-error-source">-</td></tr>
                        </table>
                        <h3>Turn-Strength Mismatch (Planner vs Oracle)</h3>
                        <table class="data-table">
                            <tr><td>Heading Delta @ 5m</td><td id="projection-heading-delta-5m">-</td></tr>
                            <tr><td>Heading Delta @ 10m</td><td id="projection-heading-delta-10m">-</td></tr>
                            <tr><td>Heading Delta @ 15m</td><td id="projection-heading-delta-15m">-</td></tr>
                            <tr><td>Curvature Ratio @ 5m</td><td id="projection-curvature-ratio-5m">-</td></tr>
                            <tr><td>Curvature Ratio @ 10m</td><td id="projection-curvature-ratio-10m">-</td></tr>
                            <tr><td>Curvature Ratio @ 15m</td><td id="projection-curvature-ratio-15m">-</td></tr>
                            <tr><td>Mismatch Source</td><td id="projection-turn-mismatch-source">-</td></tr>
                        </table>
                        <h3>Right-Lane Fiducial Projection Error</h3>
                        <table class="data-table">
                            <tr><td>Reproj Error @ 5m</td><td id="projection-right-fiducial-err-5m">-</td></tr>
                            <tr><td>Reproj Error @ 10m</td><td id="projection-right-fiducial-err-10m">-</td></tr>
                            <tr><td>Reproj Error @ 15m</td><td id="projection-right-fiducial-err-15m">-</td></tr>
                            <tr><td>Mean Reproj Error</td><td id="projection-right-fiducial-err-mean">-</td></tr>
                            <tr><td>Max Reproj Error</td><td id="projection-right-fiducial-err-max">-</td></tr>
                            <tr><td>Fiducial Source</td><td id="projection-right-fiducial-source">-</td></tr>
                        </table>
                        <h3>Top-Down Display</h3>
                        <table class="data-table">
                            <tr><td>Turn Sign (Top-Down)</td><td id="projection-topdown-turn-sign">-</td></tr>
                            <tr><td>Top-Down Calibrated</td><td id="projection-topdown-calibrated">-</td></tr>
                            <tr><td>Smooth Top-Down Pose</td><td id="projection-topdown-smooth">-</td></tr>
                            <tr><td>Planner-Only Path</td><td id="projection-planner-only">-</td></tr>
                        </table>
                    </div>

                    <!-- Control Tab -->
                    <div id="control-tab" class="tab-pane">
                        <h3>Control Commands</h3>
                        <table class="data-table">
                            <tr><td>Steering</td><td id="control-steering">-</td></tr>
                            <tr><td>Throttle</td><td id="control-throttle">-</td></tr>
                            <tr><td>Brake</td><td id="control-brake">-</td></tr>
                            <tr><td>Longitudinal Accel</td><td id="control-accel">-</td></tr>
                            <tr><td>Longitudinal Jerk</td><td id="control-jerk">-</td></tr>
                            <tr><td>Ref Point X</td><td id="control-ref-x">-</td></tr>
                            <tr><td>Ref Point Y</td><td id="control-ref-y">-</td></tr>
                            <tr><td title="Planner-frame heading passed to control">Ref Heading (planner frame)</td><td id="control-ref-heading">-</td></tr>
                            <tr><td>Ref Speed</td><td id="control-ref-speed">-</td></tr>
                            <tr><td>Target Speed (raw)</td><td id="control-target-speed-raw">-</td></tr>
                            <tr><td>Target Speed (post limits)</td><td id="control-target-speed-post-limits">-</td></tr>
                            <tr><td>Target Speed (planned)</td><td id="control-target-speed-planned">-</td></tr>
                            <tr><td>Target Speed (final)</td><td id="control-target-speed-final">-</td></tr>
                            <tr><td>Target Slew Active</td><td id="control-target-speed-slew-active">-</td></tr>
                            <tr><td>Target Ramp Active</td><td id="control-target-speed-ramp-active">-</td></tr>
                            <tr><td>Launch Throttle Cap</td><td id="control-launch-throttle-cap">-</td></tr>
                            <tr><td>Launch Cap Active</td><td id="control-launch-throttle-cap-active">-</td></tr>
                        </table>
                        <h3>PID State</h3>
                        <table class="data-table">
                            <tr><td>Lateral Error</td><td id="control-lateral-error">-</td></tr>
                            <tr><td>Heading Error</td><td id="control-heading-error">-</td></tr>
                            <tr><td>Total Error</td><td id="control-total-error">-</td></tr>
                            <tr><td>Total Error (scaled)</td><td id="control-total-error-scaled">-</td></tr>
                            <tr><td>Feedforward Steering</td><td id="control-feedforward-steering">-</td></tr>
                            <tr><td>Feedback Steering</td><td id="control-feedback-steering">-</td></tr>
                            <tr><td>Straight Sign Flip Override</td><td id="control-straight-sign-flip-override">-</td></tr>
                            <tr><td>PID Integral</td><td id="control-pid-integral">-</td></tr>
                            <tr><td>PID Derivative</td><td id="control-pid-derivative">-</td></tr>
                            <tr><td>PID Error</td><td id="control-pid-error">-</td></tr>
                            <tr><td>Is Control Straight Proxy</td><td id="control-is-control-straight-proxy">-</td></tr>
                            <tr><td>Is Straight (legacy alias)</td><td id="control-is-straight">-</td></tr>
                            <tr><td>Is Road Straight</td><td id="control-is-road-straight">-</td></tr>
                            <tr><td>Road Curvature Valid</td><td id="control-road-curvature-valid">-</td></tr>
                            <tr><td>Road Curvature |k|</td><td id="control-road-curvature-abs">-</td></tr>
                            <tr><td>Straight Oscillation Rate</td><td id="control-straight-oscillation-rate">-</td></tr>
                            <tr><td>Tuned Deadband</td><td id="control-tuned-deadband">-</td></tr>
                            <tr><td>Tuned Smoothing Alpha</td><td id="control-tuned-smoothing-alpha">-</td></tr>
                            <tr><td>Using Stale Perception</td><td id="control-using-stale" style="color: #ff6b6b;">-</td></tr>
                            <tr><td>Stale Reason</td><td id="control-stale-reason" style="color: #ff6b6b;">-</td></tr>
                        </table>
                        <h3>Steering Limiter Waterfall</h3>
                        <table class="data-table">
                            <tr><td>Pre Rate Limit</td><td id="control-steering-pre-rate">-</td></tr>
                            <tr><td>Rate Limit Schedule (Base(Error) / CurveScale / AfterCurveScale / AfterCurveFloor / FinalEffective)</td><td id="control-steering-rate-schedule">-</td></tr>
                            <tr><td>Rate Curve Inputs (|curveMetric| / min / max / scaleMin)</td><td id="control-steering-rate-curve-inputs">-</td></tr>
                            <tr><td>Rate Curve Metric Source</td><td id="control-steering-rate-curve-source">-</td></tr>
                            <tr><td>Rate Curve Regime</td><td id="control-steering-rate-curve-regime">-</td></tr>
                            <tr><td>AfterCurve Limiter Cause</td><td id="control-steering-rate-aftercurve-cause">-</td></tr>
                            <tr><td>Rate Requested Î” / Margin / Unlock Needed</td><td id="control-steering-rate-thresholds">-</td></tr>
                            <tr><td>Curve Entry Assist (cfg / active / triggered / rearmFrames / boosts)</td><td id="control-steering-curve-entry-assist">-</td></tr>
                            <tr><td>Curve Entry Schedule (cfg / active / triggered / handoff / framesRemain)</td><td id="control-steering-curve-entry-schedule-primary">-</td></tr>
                            <tr class="compact-subrow"><td>&nbsp;&nbsp;Context (proxy/upcoming/atCar/road)</td><td id="control-steering-curve-entry-schedule-context">-</td></tr>
                            <tr class="compact-subrow"><td>&nbsp;&nbsp;Params</td><td id="control-steering-curve-entry-schedule-params">-</td></tr>
                            <tr><td>Expected Curve Window (track)</td><td id="control-expected-curve-window">-</td></tr>
                            <tr><td>Curve Commit Mode (cfg / active / triggered / handoff / framesRemain / params)</td><td id="control-steering-curve-commit-mode">-</td></tr>
                            <tr><td>Curve Mode Speed Cap (cfg / active / clamped / capValue / params)</td><td id="control-steering-curve-mode-speed-cap">-</td></tr>
                            <tr><td>Rate Limited</td><td id="control-steering-rate-limited">-</td></tr>
                            <tr><td>Rate Limit Delta</td><td id="control-steering-rate-delta">-</td></tr>
                            <tr><td>Post Rate Limit</td><td id="control-steering-post-rate">-</td></tr>

                            <tr><td>Jerk Limit (effective / curveScale)</td><td id="control-steering-jerk-schedule">-</td></tr>
                            <tr><td>Jerk Requested Î”rate / Allowed Î”rate</td><td id="control-steering-jerk-thresholds">-</td></tr>
                            <tr><td>Jerk Margin / Unlock Needed</td><td id="control-steering-jerk-unlock">-</td></tr>
                            <tr><td>Jerk Limited</td><td id="control-steering-jerk-limited">-</td></tr>
                            <tr><td>Jerk Limit Delta</td><td id="control-steering-jerk-delta">-</td></tr>
                            <tr><td>Post Jerk Limit</td><td id="control-steering-post-jerk">-</td></tr>

                            <tr><td>Post Sign-Flip Override</td><td id="control-steering-post-sign-flip">-</td></tr>

                            <tr><td>Hard Clipped</td><td id="control-steering-hard-clipped">-</td></tr>
                            <tr><td>Hard Clip Delta</td><td id="control-steering-hard-clip-delta">-</td></tr>
                            <tr><td>Post Hard Clip</td><td id="control-steering-post-hard-clip">-</td></tr>

                            <tr><td>Smoothing Active</td><td id="control-steering-smoothing-active">-</td></tr>
                            <tr><td>Smoothing Delta</td><td id="control-steering-smoothing-delta">-</td></tr>
                            <tr><td>Post Smoothing (Final)</td><td id="control-steering-post-smoothing">-</td></tr>
                        </table>
                    </div>

                    <!-- Vehicle Tab -->
                    <div id="vehicle-tab" class="tab-pane">
                        <h3>Camera Calibration</h3>
                        <table class="data-table">
                            <tr><td>8m Screen Y (px)</td><td id="vehicle-camera-8m-y">-</td></tr>
                            <tr><td>8m Screen Y (status)</td><td id="vehicle-camera-8m-status">-</td></tr>
                            <tr><td>Vertical FOV (Â°)</td><td id="vehicle-camera-fov-vertical">-</td></tr>
                            <tr><td>Horizontal FOV (Â°)</td><td id="vehicle-camera-fov-horizontal">-</td></tr>
                            <tr><td>Config Horizontal FOV (Â°)</td><td id="vehicle-camera-fov-config">-</td></tr>
                            <tr><td>Config Camera Height (m)</td><td id="vehicle-camera-height-config">-</td></tr>
                        </table>
                        <h3>Unity Timing</h3>
                        <table class="data-table">
                            <tr><td>Camera Timestamp</td><td id="vehicle-camera-timestamp">-</td></tr>
                            <tr><td>Top-Down Timestamp</td><td id="vehicle-topdown-timestamp">-</td></tr>
                            <tr><td>Camera Frame ID</td><td id="vehicle-camera-frame-id">-</td></tr>
                            <tr><td>Top-Down Frame ID</td><td id="vehicle-topdown-frame-id">-</td></tr>
                            <tr><td>Camera Timestamp Reused</td><td id="vehicle-camera-timestamp-reused">-</td></tr>
                            <tr><td>Unity Time</td><td id="vehicle-unity-time">-</td></tr>
                            <tr><td>Top-Down â†” Trajectory Î”t</td><td id="vehicle-topdown-traj-delta">-</td></tr>
                            <tr><td>Top-Down â†” Unity Î”t</td><td id="vehicle-topdown-unity-delta">-</td></tr>
                            <tr><td>Top-Down Sync Trust</td><td id="vehicle-topdown-sync-trust">-</td></tr>
                            <tr><td>Unity Frame</td><td id="vehicle-unity-frame">-</td></tr>
                            <tr><td>Delta Time</td><td id="vehicle-unity-delta-time">-</td></tr>
                            <tr><td>Smooth Delta Time</td><td id="vehicle-unity-smooth-delta-time">-</td></tr>
                            <tr><td>Unscaled Delta Time</td><td id="vehicle-unity-unscaled-delta-time">-</td></tr>
                            <tr><td>Time Scale</td><td id="vehicle-unity-time-scale">-</td></tr>
                            <tr><td>Unity Time Gap</td><td id="vehicle-unity-time-gap">-</td></tr>
                            <tr><td>Unity Frame Reused</td><td id="vehicle-unity-frame-reused">-</td></tr>
                        </table>
                        <h3>Steering (Unity)</h3>
                        <table class="data-table">
                            <tr><td>Steering Input (norm)</td><td id="vehicle-steering-input">-</td></tr>
                            <tr><td>Desired Steer Angle (Â°)</td><td id="vehicle-desired-steer-angle">-</td></tr>
                            <tr><td>Steering Angle Actual (Â°)</td><td id="vehicle-steering-angle-actual">-</td></tr>
                        </table>
                        <h3>Camera Position (Unity)</h3>
                        <table class="data-table">
                            <tr><td>Position X (world)</td><td id="vehicle-camera-pos-x">-</td></tr>
                            <tr><td>Height Above Ground</td><td id="vehicle-camera-pos-y">-</td></tr>
                            <tr><td>Position Z (world)</td><td id="vehicle-camera-pos-z">-</td></tr>
                            <tr><td>Forward X</td><td id="vehicle-camera-forward-x">-</td></tr>
                            <tr><td>Forward Y</td><td id="vehicle-camera-forward-y">-</td></tr>
                            <tr><td>Forward Z</td><td id="vehicle-camera-forward-z">-</td></tr>
                        </table>
                        <h3>Road Center Debug</h3>
                        <table class="data-table">
                            <tr><td>At Car X</td><td id="vehicle-road-center-at-car-x">-</td></tr>
                            <tr><td>At Car Y</td><td id="vehicle-road-center-at-car-y">-</td></tr>
                            <tr><td>At Car Z</td><td id="vehicle-road-center-at-car-z">-</td></tr>
                            <tr><td>At Lookahead X</td><td id="vehicle-road-center-at-lookahead-x">-</td></tr>
                            <tr><td>At Lookahead Y</td><td id="vehicle-road-center-at-lookahead-y">-</td></tr>
                            <tr><td>At Lookahead Z</td><td id="vehicle-road-center-at-lookahead-z">-</td></tr>
                            <tr><td>Actual Distance (m)</td><td id="vehicle-road-center-actual-distance">-</td></tr>
                            <tr><td>Reference T</td><td id="vehicle-road-center-reference-t">-</td></tr>
                            <tr><td>Car Offset X<br/><small style="color: #888;">(car X - road center X)</small></td><td id="vehicle-road-center-offset-x">-</td></tr>
                            <tr><td>Car Offset Z<br/><small style="color: #888;">(car Z - road center Z)</small></td><td id="vehicle-road-center-offset-z">-</td></tr>
                        </table>
                        <h3>Position</h3>
                        <table class="data-table">
                            <tr><td>X</td><td id="vehicle-x">-</td></tr>
                            <tr><td>Y</td><td id="vehicle-y">-</td></tr>
                            <tr><td>Z</td><td id="vehicle-z">-</td></tr>
                        </table>
                        <h3>Motion</h3>
                        <table class="data-table">
                            <tr><td>Speed</td><td id="vehicle-speed">-</td></tr>
                            <tr><td>Distance from Start</td><td id="vehicle-distance-from-start">-</td></tr>
                            <tr><td>Longitudinal Accel</td><td id="vehicle-accel">-</td></tr>
                            <tr><td>Longitudinal Jerk</td><td id="vehicle-jerk">-</td></tr>
                            <tr><td>Speed Limit</td><td id="vehicle-speed-limit">-</td></tr>
                            <tr><td>Speed Limit Preview</td><td id="vehicle-speed-limit-preview">-</td></tr>
                            <tr><td>Preview Distance</td><td id="vehicle-speed-limit-preview-distance">-</td></tr>
                            <tr><td title="Vehicle world heading from pose/quaternion">Heading (vehicle/world)</td><td id="vehicle-heading">-</td></tr>
                            <tr><td>Steering Angle</td><td id="vehicle-steering">-</td></tr>
                        </table>
                    </div>

                    <!-- Ground Truth Tab -->
                    <div id="ground-truth-tab" class="tab-pane">
                        <h3>Lane Positions</h3>
                        <table class="data-table">
                            <tr><td>Left Lane Line X</td><td id="gt-left-x">-</td></tr>
                            <tr><td>Right Lane Line X</td><td id="gt-right-x">-</td></tr>
                            <tr><td>Lane Center X</td><td id="gt-center-x">-</td></tr>
                            <tr><td>Lane Width</td><td id="gt-width">-</td></tr>
                            <tr><td>Path Curvature</td><td id="gt-path-curvature">-</td></tr>
                            <tr><td>Curve Speed Limit</td><td id="gt-curve-speed-limit">-</td></tr>
                        </table>
                        <h3>Comparison</h3>
                        <table class="data-table">
                            <tr><td>Lane Width Error<br/><small style="color: #888;">(perception vs GT)</small></td><td id="gt-width-error">-</td></tr>
                            <tr><td>Center Offset Error<br/><small style="color: #888;">(perception vs GT)</small></td><td id="gt-center-error">-</td></tr>
                        </table>
                    </div>

                    <!-- Charts Tab -->
                    <div id="charts-tab" class="tab-pane">
                        <div class="chart-builder">
                            <div class="chart-controls">
                                <div class="chart-row">
                                    <label>X Axis</label>
                                    <select id="chart-x-axis"></select>
                                </div>
                                <div class="chart-row">
                                    <label>Search Signals</label>
                                    <input id="chart-signal-search" type="text" placeholder="e.g., vehicle/speed">
                                </div>
                                <div class="chart-row">
                                    <label>Signals</label>
                                    <div id="chart-signal-list" class="chart-signal-list"></div>
                                </div>
                                <div class="chart-row">
                                    <label>Curve Shading</label>
                                    <label class="chart-toggle">
                                        <input type="checkbox" id="chart-shade-curves">
                                        Shade curve sections
                                    </label>
                                    <select id="chart-curvature-signal"></select>
                                </div>
                                <div class="chart-row">
                                    <label>Curve Thresholds</label>
                                    <div class="chart-thresholds">
                                        <input id="chart-curve-threshold-light" type="number" step="0.001" value="0.01">
                                        <input id="chart-curve-threshold-dark" type="number" step="0.001" value="0.02">
                                    </div>
                                </div>
                                <div class="chart-row chart-actions">
                                    <button id="chart-plot-btn" class="btn btn-primary">Plot</button>
                                    <button id="chart-clear-btn" class="btn btn-secondary">Clear</button>
                                </div>
                                <div class="chart-row chart-save">
                                    <input id="chart-view-name" type="text" placeholder="Save view name">
                                    <button id="chart-save-btn" class="btn btn-secondary">Save View</button>
                                </div>
                                <div class="chart-row">
                                    <label>Saved Views</label>
                                    <div class="chart-saved-views-row">
                                        <select id="chart-saved-views-select"></select>
                                        <button id="chart-load-btn" class="btn btn-secondary">Load</button>
                                        <button id="chart-overwrite-btn" class="btn btn-secondary">Overwrite</button>
                                        <button id="chart-delete-btn" class="btn btn-secondary">Delete</button>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-canvas">
                                <div class="chart-zoom-controls">
                                    <button id="chart-zoom-in-btn" class="btn btn-secondary">Zoom In</button>
                                    <button id="chart-zoom-out-btn" class="btn btn-secondary">Zoom Out</button>
                                    <button id="chart-zoom-reset-btn" class="btn btn-secondary">Reset Zoom</button>
                                </div>
                                <canvas id="chart-canvas" width="640" height="480"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom: Navigation Controls -->
        <div class="navigation">
            <button id="prev-frame-btn" class="btn btn-nav">â—€</button>
            <div class="frame-info">
                <span>Frame: <span id="frame-number">0</span> / <span id="frame-count">0</span></span>
                <input type="range" id="frame-slider" min="0" max="0" value="0" class="frame-slider">
                <span>Time: <span id="frame-time">0.00</span>s</span>
                <span>Distance: <span id="frame-distance-from-start">-</span>m</span>
                <span>Expected: <span id="frame-expected-curve-window">-</span></span>
                <input type="number" id="frame-jump-input" placeholder="Jump to frame..." min="0" style="width: 120px; padding: 0.25rem; margin-left: 0.5rem; background: #2a2a2a; color: white; border: 1px solid #444; border-radius: 4px;">
                <button id="frame-jump-btn" class="btn btn-secondary" style="margin-left: 0.25rem; padding: 0.25rem 0.5rem;">Go</button>
            </div>
            <button id="next-frame-btn" class="btn btn-nav">â–¶</button>
            <button id="play-pause-btn" class="btn btn-nav">â–¶ Play</button>
            <div class="speed-control">
                <label>Speed: <span id="speed-value">1x</span></label>
                <input type="range" id="speed-slider" min="0.25" max="4" step="0.25" value="1">
            </div>
        </div>
    </div>

    <script src="data_loader.js?v=20260218_track_curve_windows_v44"></script>
    <script src="overlay_renderer.js?v=20260213_issues_filters"></script>
    <script src="visualizer.js?v=20260218_dynamic_curve_clipalign_v50"></script>
</body>
</html>

